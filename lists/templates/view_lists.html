<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {% load static %}
    <title>Create List</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" href="{% static 'lists/lists.css' %}">
</head>
<body>

    <nav class="navbar navbar-expand-lg">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Checkpoint</a>
            <div class="collapse navbar-collapse justify-content-end">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'userProfile:myProfile' %}">My Profile</a>
                    </li>
                    
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'logout' %}">Logout</a>
                    </li>

                </ul>
            </div>
        </div>
    </nav>
    <div class="container">
        <div class="tabs mt-5">
            <button id="myListsTab" class="btn btn-primary tab-button active" onclick="fetchLists('my')">My Lists</button>
            <button id="discoverListsTab" class="btn btn-primary tab-button ml-2" onclick="fetchLists('discover')">Discover Lists</button>
            <a href="{% url 'lists:create_list'%}" class="btn btn-primary tab-button ml-2">Make a new Game List</a>
        </div>

        <div id="listContainer" class="list-container mt-4">
            <!-- Cards will be populated here dynamically -->
        </div>

        <button id="loadMoreBtn" class="btn btn-success mt-3" onclick="loadMore()">Load More</button>
    </div>

    <script>
        let currentPage = 1;
        let currentTab = 'my';

        function fetchLists(tab) {
            currentTab = tab;
            currentPage = 1;
            document.getElementById("listContainer").innerHTML = ''; // Clear list container
            document.getElementById("loadMoreBtn").style.display = 'block';
            loadMore();
        }

        function loadMore() {
            fetch(`{% url 'lists:get_lists' %}?tab=${currentTab}&page=${currentPage}`)
                .then(response => response.json())
                .then(data => {
                    data.lists.forEach(list => {
                        const listCard = document.createElement('div');
                        listCard.className = 'list-card card mt-3';
                        listCard.innerHTML = `
                            <div class="card-body">
                                <h5 class="card-title">${list.name}</h5>
                                <p class="card-text">${list.description}</p>
                                <p class="card-text"><strong>Creator:</strong> ${list.creator}</p>
                                <p class="card-text"><strong>Games:</strong> ${list.games_count}</p>
                            </div>
                        `;
                        document.getElementById("listContainer").appendChild(listCard);
                    });

                    if (data.has_more) {
                        currentPage++;
                    } else {
                        document.getElementById("loadMoreBtn").style.display = 'none';
                    }
                })
                .catch(error => console.error("Error fetching lists:", error));
        }

        document.addEventListener('DOMContentLoaded', () => {
            fetchLists('my');
        });
    </script>
</body>
</html>